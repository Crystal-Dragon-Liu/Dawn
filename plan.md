# 说明

"*" 表示待完成任务

other 标签下的任务不需要做记号，完成即删除

# 开发

## other

辅助设施：
- LOG宏
  - 需要能够接收任意类型和数量的参数
  - 能够打印例如时间等更多的信息，并且能够控制打印内容

## 存储层

### 磁盘管理

总体功能：
- 对内负责初始化磁盘管理的元数据
- 对外负责普通页面的读写分配和回收
- 对外负责日志页面的读写

任务：
- 磁盘管理初始化
  - 元数据文件存在的初始化
  - 元数据文件不存在的初始化
- 普通页面管理
  - 读页面
  - 写页面
  - 分配新页面
  - 释放页面
- *并发使用DiskManager(待计划)
- *日志页面管理(待计划)
- *定期裁剪文件大小(待计划)
- *对元数据文件的logging和recovery(待计划)

### 页面布局

## 缓冲池

总体功能：
- 对外分配和回收页面，外部向BMP请求或者归还页面，后者把页面给它或者处理归还页面
- 对内决定页面的去留，视情况将页面从内存删除并冲刷回磁盘

任务：
- clock replacer的实现
- buffer pool manager的实现
   - *对日志和事务的支持(未来实现)

## 索引层

总体功能：
- 将表中的数据按照某种方式有规律的组织起来，方便查找
- 表数据在更新的时候本层也做相应的更新，所以对外开放增删查改接口

任务：
- 完成哈希法，使用链表法解决冲突机制(InnoDB也是如此)

Tips：有关事务和日志等功能应该被嵌入其中，但是考虑到方便就暂时没有实现，留作以后重写

## 执行器

待计划

## 查询计划

待计划

## 系统元数据

总体功能：
- 记录系统运行过程中需要的元数据
- 当元数据不在内存时需要能够从磁盘加载

任务：
- 记录系统运行时所需的信息
  - 表名对应的编号和page_id(有限数量表即可)
  - 某张表对应的索引头页page id

## 数据类型和数据

总体功能：
- 封装数据类型，提供转为数据库准备的数据类型
- 提供数据需要的相关操作

任务：
- *Type抽象类(目前只实现这四种类型，暂时没必要实现更多的类型)
  - Bool
  - Integer
  - *Decimal
  - *Varchar
- *Value类

############################################################

# 测试

## other

打开内存泄漏检测

磁盘管理测试的辅助：
- 创建几个已经有内容的元数据文件和相关的.db .log文件，方便以后反复使用

## 存储层测试

### 磁盘管理

- 磁盘管理初始化
  - 元数据文件存在的初始化
    - 正确收集page id信息
  - 元数据文件不存在的初始化
- 普通页面管理
  - 读、写、分配和释放页面
  - *并发分配和释放页面 

## 缓冲池测试

因为实现还很不稳定所以接口要封装

- clock replacer非并发
  - unpin一些页框，能够把它们全部逐出
  - unpin一些页框，pin其中的一部分，剩下的全部逐出
  - 逐出时没有可逐出页框，等待，放入页框后成功逐出
- buffer pool manager非并发
  - 针对一个页面作如下操作：创建，写，驱逐，拿，读，写，冲刷，直读磁盘，最后删除
  - 从缓冲池获取若干页面，pin住其中的一部分并写入然后再从缓冲池大量获取并归还，保证pinned页面仍在缓冲池中，unpinned不在缓冲池，并且内容已经被写回了磁盘

- *clock replacer并发
- *buffer pool manager并发


## 索引层测试

因为实现还很不稳定所以接口要封装

## 执行器测试

待计划

## 查询计划测试

待计划